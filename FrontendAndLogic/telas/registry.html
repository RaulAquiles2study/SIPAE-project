<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico de uso</title>
    <link rel="stylesheet" href="../css/estilo-novo.css"/>
    <link rel="stylesheet" href="../css/estilo-materiais.css"/>
</head>
<body>
    <div class="container">
        <aside class="menu-lateral">
        </aside>

        <main class="conteudo">
            <header class="cabecalho">
                <h1>Histórico de uso</h1>
            </header>

            <section class="cards"></section>
            <div class="footButtons">
                <button class='botunn' id='allbck'><<</button>
                <button class='botunn' id='bck'><</button>
                <b id='showin'></b>
                <button class='botunn' id='fwd'>></button>
                <button class='botunn' id='allfwd'>>></button>
            </div>
        </main>
    </div>
    <script type="module" src="../script.js"></script>
</body>
</html>

<script type="module">
import {criarSidebar,makeRequest,redirecionar,getUser,getRankString} from '../script.js';
document.querySelector('.menu-lateral').appendChild(await criarSidebar())

var page = 0;
var limit = 20;
var i = page*limit;
var showing = 0;
var totalLen = 0;
async function reload(){
    i=(page*limit)
    const data = (await makeRequest('registry',null,'GET',true)).result
    console.log(data);
    console.log(page)
    totalLen = data.length;
    const base = document.getElementsByClassName('cards')[0]
    while (base.firstChild!=null){
        base.removeChild(base.firstChild);
    }

    while (i<((page*limit)+limit)&&i<data.length) {
        const item = data[i];
        console.log(item)//prints the correct item, so I got no idea why they're not being fucking appended.
        const thingy = await getThingy(item)
        base.appendChild(thingy)
        i++
        showing++
    }
}
async function getThingy(item){
    const novoCard = document.createElement('div');
    novoCard.classList.add('card-personalizado');
    const novoDiv = document.createElement('div');
    novoDiv.className = 'conteudo-card';

     const h3 = document.createElement('h2');
    h3.textContent = item.user;
    novoDiv.appendChild(h3);

    const p = document.createElement('p');
    p.textContent = 'email: '+item.useremail;
    novoDiv.appendChild(p);

    const role = document.createElement('h3');
    role.textContent = item.acao;
    novoDiv.appendChild(role)

    const date = document.createElement('h3');
    const dateobj = new Date(item.data);
    date.textContent = `${dateobj.getDate()+1}/${dateobj.getMonth()+1}/${dateobj.getFullYear()} ${dateobj.getHours()}:${dateobj.getMinutes()}`;
    novoDiv.appendChild(date)

    novoCard.appendChild(novoDiv);

    return novoCard;
}
document.getElementById('bck').onclick = async()=>{
  page--;
  if (page<0)page=0
  reload();
}
document.getElementById('allbck').onclick = async()=>{
  page = 0
  reload();
}
document.getElementById('fwd').onclick = async()=>{
  page++;
  if (page>Math.floor(totalLen/limit)){
    page = Math.floor(totalLen/limit);
  }
  reload();
}
document.getElementById('allfwd').onclick = async()=>{
  page = Math.floor(totalLen/limit);
  reload();
}
await reload();
</script>