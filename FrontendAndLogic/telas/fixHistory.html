<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manutenções</title>
    <link rel="stylesheet" href="../css/estilo-novo.css"/>
    <link rel="stylesheet" href="../css/estilo-materiais.css"/>
</head>
<body>
    <div class="container">
        <aside class="menu-lateral"></aside>

        <main class="conteudo">
            <header class="cabecalho">
                <h1>Histórico de Manutenções</h1>
                <p id="totalObjects"></p>
                <p id="totalMaintenances"></p>
                <p id="totalCosts"></p>
            </header>

            <section class="cards"></section>
        </main>
    </div>
    <script type="module" src="../script.js"></script>
</body>
</html>
<script type="module">
import {criarSidebar,makeRequest,redirecionar,getUser,getRankString} from '../script.js';
document.querySelector('.menu-lateral').appendChild(await criarSidebar())

async function reload(){
 const data = (await makeRequest('manutencoes/1',null,'GET',true)).result
 console.log(data)
 const objs = data.maintenanceObjects??[];
 const base = document.querySelector('.cards')

  const b1 = document.createElement('button')
 b1.className = 'botunn';
 b1.innerText = 'Ver manutenções em progresso'
 b1.onclick = async()=>{
  redirecionar('fixers');
 }
 base.appendChild(b1);
 if(Object.values(objs).length<1)return;

 for (const man of data.maintenanceObjects){
  console.log(man)
  base.appendChild(await getThingy(man))
 }
}

async function getThingy(item){
 const novoCard = document.createElement('div');
 novoCard.classList.add('card-personalizado');
 const novoDiv = document.createElement('div');
 novoDiv.className = 'conteudo-card';

 const t1 = document.createElement('h2');
 t1.textContent = item.objType;
 novoDiv.appendChild(t1);

 const t2 = document.createElement('h5');
 t2.textContent = item.descricao;
 novoDiv.appendChild(t2);

 const t3 = document.createElement('h3');
 t3.textContent = 'Valor: '+item.sumValue;
 novoDiv.appendChild(t3);

 const t4 = document.createElement('h4');
 t4.textContent = 'Objetos: '+item.objects.length;
 novoDiv.appendChild(t4);

 console.log(item.data)
 const dateobj = new Date(item.data)
 const t5 = document.createElement('h4');
 t5.textContent = `Pedido em: ${dateobj.getDate()+1}/${dateobj.getMonth()+1}/${dateobj.getFullYear()}`;
 novoDiv.appendChild(t5);

 const dateobj2 = new Date(item.retornoEsperado)
 const t6 = document.createElement('h4');
 t6.textContent = `Expectativa de entrega em: ${dateobj2.getDate()+1}/${dateobj2.getMonth()+1}/${dateobj2.getFullYear()}`;
 novoDiv.appendChild(t6);

 novoCard.appendChild(novoDiv);

 return novoCard;
}
await reload();
</script>